<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GitHub Repository Finder</title>
  <style>
    /* CSS t·ªïng quan: reset box model v√† margin */
    *{box-sizing:border-box;margin:0;padding:0}
    /* body: theme t·ªëi v√† padding chung */
    body{font-family:Segoe UI,Arial;background:#0d1117;color:#c9d1d9;padding:18px}
    /* container ch√≠nh ƒë·ªÉ cƒÉn gi·ªØa n·ªôi dung */
    .container{max-width:1000px;margin:0 auto}
    header{margin-bottom:14px}
    h1{color:#58a6ff} /* ti√™u ƒë·ªÅ ch√≠nh */
    /* card: h·ªôp ch·ª©a controls (search + filter) */
    .card{background:#0b1115;padding:14px;border-radius:8px;border:1px solid #222;margin-bottom:12px}
    /* layout thanh t√¨m ki·∫øm: input + button */
    .search{display:flex;gap:8px;align-items:center}
    .search input{flex:1;padding:10px;border-radius:6px;border:1px solid #30363d;background:#0d1117;color:#c9d1d9}
    .search button{padding:10px 14px;border-radius:6px;background:#238636;color:#fff;border:none;cursor:pointer}
    /* filter area (sort select) */
    .filters{display:flex;gap:8px;align-items:center;margin-top:8px}
    .repo-list{margin-top:12px} /* n∆°i render danh s√°ch repo */
    /* card cho t·ª´ng repo */
    .repo{background:#0b1115;border:1px solid #222;padding:12px;border-radius:8px;margin-bottom:10px}
    .repo a{color:#58a6ff;text-decoration:none;font-weight:700} /* link repo */
    .meta{color:#8b949e;margin-top:8px;font-size:14px;display:flex;gap:12px;flex-wrap:wrap} /* th√¥ng tin ph·ª• */
    .load-more{display:flex;justify-content:center;margin-top:12px} /* n√∫t load more */
    .load-more button{padding:10px 18px;border-radius:8px;background:#161b22;color:#c9d1d9;border:none;cursor:pointer}
    .error{background:#da3633;color:#fff;padding:10px;border-radius:8px;margin-bottom:12px} /* hi·ªÉn th·ªã l·ªói */
    .empty{color:#8b949e;padding:12px} /* vƒÉn b·∫£n tr·ªëng/ƒëang load */
  </style>
</head>
<body>
  <div class="container">
    <!-- Header: title v√† m√¥ t·∫£ -->
    <header>
      <h1>üîç GitHub Repository Finder</h1>
      <p style="color:#8b949e">Search and explore GitHub repositories</p>
    </header>

    <!-- Card ch·ª©a √¥ t√¨m ki·∫øm v√† b·ªô l·ªçc -->
    <div class="card">
      <div class="search">
        <!-- Input t√¨m ki·∫øm (Enter ƒë·ªÉ submit) -->
        <input id="searchInput" placeholder="Search repositories... (e.g. react)" onkeypress="if(event.key==='Enter') performSearch()">
        <!-- N√∫t t√¨m ki·∫øm -->
        <button onclick="performSearch()">Search</button>
      </div>
      <!-- B·ªô l·ªçc s·∫Øp x·∫øp (khi thay ƒë·ªïi s·∫Ω ch·∫°y t√¨m l·∫°i) -->
      <div class="filters" style="margin-top:8px">
        <label style="color:#8b949e">Sort by:</label>
        <select id="sortSelect" onchange="performSearch()">
          <option value="stars">stars</option>
          <option value="forks">forks</option>
          <option value="updated">updated</option>
        </select>
      </div>
    </div>

    <!-- N∆°i hi·ªÉn th·ªã l·ªói n·∫øu c√≥ -->
    <div id="errorMessage"></div>
    <!-- N∆°i render danh s√°ch repository -->
    <div id="repoList" class="repo-list"></div>
    <!-- N∆°i ƒë·∫∑t n√∫t Load more / pagination -->
    <div id="loadMoreContainer" class="load-more"></div>
  </div>

  <script>
    // Bi·∫øn tr·∫°ng th√°i cho pagination / sort / query
    let currentPage = 1;
    let currentQuery = '';
    let currentSort = 'stars';
    let totalResults = 0;

    // Tham chi·∫øu DOM element c·∫ßn d√πng
    const repoListEl = document.getElementById('repoList');
    const loadMoreContainer = document.getElementById('loadMoreContainer');
    const errorMessage = document.getElementById('errorMessage');

    // Hi·ªÉn th·ªã l·ªói (ƒë∆°n gi·∫£n, 1 d√≤ng)
    function showError(msg){ errorMessage.innerHTML = `<div class="error">${msg}</div>`; }
    // X√≥a l·ªói
    function clearError(){ errorMessage.innerHTML = ''; }

    // Format s·ªë l·ªõn th√†nh 1.5k / 2.3M cho hi·ªÉn th·ªã g·ªçn
    function formatNumber(num){
      if(num >= 1000000) return (num/1000000).toFixed(1)+'M';
      if(num >= 1000) return (num/1000).toFixed(1)+'k';
      return String(num);
    }

    /* 
      G·ªçi GitHub Search API ƒë·ªÉ t√¨m repositories.
      - query: t·ª´ kh√≥a
      - sort: stars|forks|updated
      - page, per_page: pagination
      N·∫øu response kh√¥ng ok s·∫Ω n√©m l·ªói c√≥ thu·ªôc t√≠nh status ƒë·ªÉ x·ª≠ l√Ω ·ªü caller.
    */
    async function searchRepositories(query, sort='stars', page=1, per_page=10){
      const url = `https://api.github.com/search/repositories?q=${encodeURIComponent(query)}&sort=${encodeURIComponent(sort)}&page=${page}&per_page=${per_page}`;
      const res = await fetch(url);
      if(!res.ok){
        const err = new Error('HTTP '+res.status);
        err.status = res.status;
        throw err;
      }
      return res.json(); // tr·∫£ v·ªÅ JSON ƒë√£ parse
    }

    /*
      T·∫°o HTML cho m·ªôt repo card t·ª´ object repo tr·∫£ v·ªÅ
      Hi·ªÉn th·ªã: full_name (link), description, stars, forks, owner, language, updated date
    */
    function createRepoCard(repo){
      const desc = repo.description ? repo.description : '';
      const lang = repo.language ? repo.language : '‚Äî';
      return `
        <div class="repo">
          <div><a href="${repo.html_url}" target="_blank" rel="noopener">${repo.full_name}</a></div>
          <div class="repo-desc" style="color:#8b949e;margin-top:6px">${desc}</div>
          <div class="meta">
            <div>‚≠ê ${formatNumber(repo.stargazers_count)}</div>
            <div>üî± ${formatNumber(repo.forks_count)}</div>
            <div>üßë ${repo.owner?.login || '‚Äî'}</div>
            <div class="language">üí† ${lang}</div>
            <div>Updated: ${new Date(repo.updated_at).toLocaleDateString()}</div>
          </div>
        </div>
      `;
    }

    /*
      Render danh s√°ch repositories l√™n UI.
      - append = false => replace to√†n b·ªô (m·ªôt t√¨m ki·∫øm m·ªõi)
      - append = true => th√™m v√†o cu·ªëi (load more)
    */
    function displayRepositories(items, append=false){
      if(!append) repoListEl.innerHTML = '';
      if(!items || items.length === 0){
        if(!append) repoListEl.innerHTML = `<div class="empty">No results</div>`;
        return;
      }
      const html = items.map(createRepoCard).join('');
      if(append) repoListEl.insertAdjacentHTML('beforeend', html);
      else repoListEl.innerHTML = html;
    }

    /*
      performSearch: ƒë·ªçc input + sort, reset page, g·ªçi API v√† show results.
      - hi·ªÉn th·ªã loading message t·∫°m th·ªùi
      - c·∫≠p nh·∫≠t totalResults ƒë·ªÉ quy·∫øt ƒë·ªãnh c√≥ hi·ªán n√∫t Load more hay kh√¥ng
      - b·∫Øt l·ªói rate-limit (403) ho·∫∑c l·ªói kh√°c
    */
    async function performSearch(){
      clearError();
      const qEl = document.getElementById('searchInput');
      const sortEl = document.getElementById('sortSelect');
      const query = qEl.value.trim();
      const sort = sortEl.value || 'stars';
      if(!query){ showError('Nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm tr∆∞·ªõc.'); return; }
      currentQuery = query; currentSort = sort; currentPage = 1;
      repoListEl.innerHTML = `<div class="empty">Loading...</div>`;
      loadMoreContainer.innerHTML = '';
      try {
        const data = await searchRepositories(query, sort, currentPage, 10);
        totalResults = data.total_count || 0;
        displayRepositories(data.items || [], false);
        // n·∫øu c√≤n k·∫øt qu·∫£, hi·ªÉn th·ªã n√∫t Load more
        if(totalResults > currentPage * 10){
          loadMoreContainer.innerHTML = `<button onclick="loadMore()">Load more</button>`;
        } else loadMoreContainer.innerHTML = '';
      } catch (err) {
        // n·∫øu rate limit b·ªã v∆∞·ª£t (403) th√¨ hi·ªÉn th·ªã th√¥ng b√°o c·ª• th·ªÉ
        if(err.status === 403) showError('Rate limit exceeded (60 req/hour unauthenticated).');
        else showError('L·ªói khi truy v·∫•n GitHub API.');
        repoListEl.innerHTML = '';
      }
    }

    /*
      loadMore: tƒÉng page v√† t·∫£i trang ti·∫øp theo, sau ƒë√≥ append k·∫øt qu·∫£
      - x·ª≠ l√Ω t∆∞∆°ng t·ª± performSearch nh∆∞ng append = true
    */
    async function loadMore(){
      if(!currentQuery) return;
      currentPage++;
      loadMoreContainer.innerHTML = `<div class="empty">Loading more...</div>`;
      try {
        const data = await searchRepositories(currentQuery, currentSort, currentPage, 10);
        displayRepositories(data.items || [], true);
        if(totalResults > currentPage * 10) loadMoreContainer.innerHTML = `<button onclick="loadMore()">Load more</button>`;
        else loadMoreContainer.innerHTML = '';
      } catch (err) {
        if(err.status === 403) showError('Rate limit exceeded (60 req/hour).');
        else showError('L·ªói khi truy v·∫•n GitHub API.');
        loadMoreContainer.innerHTML = '';
      }
    }
  </script>
</body>
</html>
